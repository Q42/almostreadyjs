function contains(arr,v){for(var i=0;i<arr.length;i++)if(arr[i]==v)return!0;return!1}function between(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function load(scriptName){Ready.loadScript(scriptName)}function ask(question,currentAnswer){return prompt(question,currentAnswer)}function GameEvent(eventName,evt,props){for(var o in this.date=new Date,this.name=eventName,this.originalEvent=evt,props=props||{})this[o]=props[o]}function each(obj,f){if("object"==typeof obj&&obj.constructor==SpriteListInstance||Array.isArray(obj))for(var i=0;i<obj.length;i++)!function(i){f(obj[i],i)}(i);else if("object"==typeof obj)for(var id in obj)!function(id){f(obj[id],id)}(id)}function repeat(f,count){if("number"==typeof f&&"function"==typeof count)return repeat(count,f);if(!(0===count||count<0))if((count=count||1/0)<1/0)for(var i=0;i<count;i++)!function(i){f(i)}(i);else{if(repeat.__active)throw"repeat inside repeat";on.gameloop(function(){repeat.__active=!0,f.apply(null,arguments),delete repeat.__active})}}function round(){return Math.round.apply(Math,arguments)}!function(){var css="\n  html, body {\n    padding: 0; margin: 0;\n    background: #000; color: #fff;\n  }\n  #meta {\n    position: absolute;\n    left: -999999px; top: -999999px;\n    pointer-events: none;\n    visibility: hidden;\n  }\n  .sprite {\n    position: absolute;\n    left: 0; top: 0;\n    background-repeat: no-repeat;\n    background-position: center center;\n    background-size: contain;\n    -webkit-backface-visibility: hidden;\n    -moz-backface-visibility:    hidden;\n    -ms-backface-visibility:     hidden;\n    backface-visibility: hidden;\n  }\n  .sprite.inspector-selected {\n    z-index: 100 !important;\n  }\n  .sprite.inspector-selected:before {\n    content: '';\n    display: block;\n    position: absolute;\n    left: 0; top: 0; right: 0; bottom: 0;\n    background: rgba(80,80,255, .7);\n  }\n  .sprite.inspector-selected:after {\n    content: '';\n    display: block;\n    position: absolute;\n    left: -2px; top: -2px; right: -2px; bottom: -2px;\n    border: solid red 2px;\n  }\n  #game {\n    position: relative;\n    overflow: hidden;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    -webkit-touch-callout: none;\n    -moz-touch-callout: none;\n    -ms-touch-callout: none;\n    touch-callout: none;\n    /*\n    top: 50%; left: 50%;\n    -webkit-backface-visibility: hidden;\n    -moz-backface-visibility:    hidden;\n    -ms-backface-visibility:     hidden;\n    backface-visibility: hidden;\n    */\n  }\n  #world {\n    position: absolute;\n  }\n  ";setTimeout(function init(){var head=document.getElementsByTagName("head")[0];if(!head)return setTimeout(init,0);var style=document.createElement("style");style.innerHTML=css;head.appendChild(style)})}(),window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback,element){window.setTimeout(function(){callback(+new Date)},10)},window.cancelAnimFrame=window.cancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||function(){},String.prototype.letter=function(i){return this.charAt(i-1)},$=function(s){var d=document,qs="querySelectorAll",hi=!!d[qs],u=void 0,cn="className",pn="parentNode";function _getEls(sel,par){if(!sel)return[];if("object"==typeof sel){if(sel==window)return[window];if(sel.nodeType)return[sel];if(sel.length!=u)return sel}if(/^\</.test(sel)){var fr=d.createElement("div");return fr.innerHTML=sel,fr.childNodes}if(sel&&hi)return(par||d)[qs](sel);if(/^[#\.]?[\w\-_\*]+$/.test(sel)){if(/^#/.test(sel)){var p;if(r=d.getElementById(sel.substr(1))){if(!par||par==d)return[r];for(p=r[pn];p!=d;p=p[pn])if(p==par)return[r]}return[]}if(/^\./.test(sel)){var els=[];return new _$(par||d).find("*").each(function(){$(this).hasClass(sel.substr(1))&&els.push(this)}),els}return(par||d).getElementsByTagName(sel)}var $els,root,r=[];return each(sel.replace(/^\s+|\s{2}|\s+$/gi,"").split(","),function(i2,sel2){root=par||d,each(sel2.replace(/^\s+|\s+$/gi,"").split(" "),function(i3,sel3,l3){$els=0,sel3.replace(/^[\w\*]+|#[\w_-]+|\.[\w_-]+/gi,function(sel4){$els=$els?$els.filter(sel4):new _$(root).find(sel4)}),$els&&(root=$els.get(),i3==l3-1&&$els.each(function(i,o){indexOf(r,o)<0&&r.push(o)}))})}),r}function each(arr,f){for(var i=0;i<arr.length;i++)f.call(arr[i],i,arr[i],arr.length)}function indexOf(arr,o){for(var i=0;i<arr.length;i++)if(arr[i]==o)return i;return-1}function _$(sel,par){var _=_getEls(sel,par);for(var x in _)this[x]=_[x];this.length||(this.length=_.length),this._=_}return _$.prototype={closest:function(sel){var test,closest,r=[];return this.each(function(){test=$(this);do{closest=test.filter(sel),stop=test[0]==d,closest.length&&(stop=!0,closest.each(function(i,o){indexOf(r,o)<0&&r.push(o)})),test=test.parent()}while(test.length&&!stop)}),new _$(r)},each:function(f){return each(this,f),this},remove:function(){return this.each(function(){this[pn].removeChild(this)}),this},replaceWith:function(el){var me=this;return me[0]&&(el.each?el.each(function(){me[0][pn].insertBefore(this,me[0])}):me[0][pn].insertBefore(el,me[0]),me.remove()),this},appendTo:function(el){return el=el.length?el[0]:el,this.each(function(){el.appendChild(this)}),this},append:function(sel){var me=this;return me[0]&&new _$(sel).each(function(){me[0].appendChild(this)}),this},parent:function(){var r=[];return this.each(function(){indexOf(r,this[pn])<0&&r.push(this[pn])}),new _$(r)},children:function(sel){var res,e,ce=[];return this.each(function(){e=this.childNodes;for(var i=0;i<e.length;i++)ce.push(e[i])}),res=new _$(ce),sel?res.filter(sel):res},find:function(sel){var cs,i,r=[];return this.each(function(){for(cs=_getEls(sel,this),i=0;i<cs.length;i++)indexOf(r,cs[i])<0&&r.push(cs[i])}),new _$(r)},filter:function(s,iv){s=_getEls(s);var i,r=[];return this.each(function(){for(i=0;i<s.length;i++)(s[i]==this&&!iv||s[i]!=this&&iv)&&r.push(this)}),new _$(r)},not:function(sel){return this.filter(sel,!0)},eq:function(i){return new _$(this[i])},has:function(el){for(var i=0;i<this.length;i++)if(this[i]==el)return!0},get:function(i){return i==u?this._:this._[i]},attr:function(k,v){return v===u?this[0]&&this[0].getAttribute(k):(this.each(function(){this[(null===v?"remove":"set")+"Attribute"](k,v)}),this)},on:function(e,f){return e=e.toLowerCase().split(" "),this.each(function(i,o){for(var x in e)this["on"+e[x]]=function(){return f.apply(o,arguments)}}),this},off:function(e){return e=e.toLowerCase().split(" "),this.each(function(){for(var x in e)this["on"+e[x]]=null}),this},click:function(h){return this.on("click",f),this},text:function(t){return t===u?this[0]&&this[0].textContent:(this.each(function(){this.textContent=t}),this)},html:function(h){return h===u?this[0]&&this[0].innerHTML:(this.each(function(){this.innerHTML=h}),this)},hasClass:function(cl,h){return h=0,this.each(function(){h+=new RegExp("(^| )"+cl+"( |$)","gi").test(this[cn])?1:0}),!!h},addClass:function(cl){return this.removeClass(cl),cl=cl.split(" "),this.each(function(){for(var i in cl)this[cn]=(this[cn]+" "+cl[i]).replace(/^ |(\s)\s+|\s+$/g,"$1")}),this},removeClass:function(cl){return cl=cl.split(" "),this.each(function(){for(var i in cl)this[cn]=this[cn].replace(new RegExp("(^| )"+cl[i]+"\\b","gi"),"").replace(/^ |(\s)\s+|\s+$/g,"$1")}),this},toggleClass:function(cl){for(var x in cl=cl.split(" "))cl[x]&&this[(this.hasClass(cl[x])?"remove":"add")+"Class"](cl[x]);return this},setCss:function(p,v){return this.each(function(){this.style[p]=v}),this},getCss:function(p){return this[0]&&this[0].style[p]},css:function(a,b){if("string"==typeof a){if(b===u)return this.getCss(a);this.setCss(a,b)}else for(var x in a)this.setCss(x,a[x]);return this},hide:function(){return this.setCss("display","none"),this},val:function(v){return v==u?this[0]?this[0].value:u:(this.each(function(i,o){o.value=v}),this)},show:function(){return this.setCss("display","block"),this},focus:function(){return this.length&&this[0].focus(),this}},new _$(s)},$.browser=new function(){var ualc=navigator.userAgent.toLowerCase();this.webkit=/applewebkit/.test(ualc),this.firefox=/firefox/.test(ualc),this.safari=/safari/.test(ualc)&&!/chrome/.test(ualc),this.ie=/msie/.test(ualc)||/trident/.test(ualc),this.iemobile=/iemobile/.test(ualc),this.iOS=/ipad|iphone|ipod/.test(ualc),this.android=/android/.test(ualc),this.s40=/series40/.test(ualc),this.mobile=this.iOS||this.android||this.iemobile,this.unknown=!(this.webkit||this.firefox||this.ie||this.iOS||this.android),this.version=parseFloat(this.webkit?ualc.match(/applewebkit\/(\d+)\./)[1]:this.firefox?ualc.match(/firefox\/(\d+)\./)[1]:this.ie?ualc.match(/(msie\s|rv\:)(\d+)\./)[2]:-1),this.retina=window.devicePixelRatio&&window.devicePixelRatio>=2&&this.iOS};for(var KeyCodes={escape:27,space:32,left:37,up:38,right:39,down:40,enter:13,backspace:8,left:37},c=65;c<=90;c++)KeyCodes[String.fromCharCode(c).toLowerCase()]=c;for(c=48;c<=57;c++)KeyCodes[String.fromCharCode(c).toLowerCase()]=c;for(var o in KeyCodes.codes={},KeyCodes)KeyCodes.codes[KeyCodes[o]]=o;window.Keys=new function(){var keyCodesHeldDown={};function init(){document.addEventListener("visibilitychange",function(evt){"hidden"==document.visibilityState&&(keyCodesHeldDown={})}),document.addEventListener("keydown",keydown),document.addEventListener("keyup",keyup)}function keydown(evt){var key=KeyCodes.codes[evt.keyCode];key&&(keyCodesHeldDown[evt.keyCode]=key)}function keyup(evt){KeyCodes.codes[evt.keyCode]&&delete keyCodesHeldDown[evt.keyCode]}init(),this.init=init,this.cycle=function(){if(Object.keys(keyCodesHeldDown).length)for(var keyCode in keyCodesHeldDown)keyCodesHeldDown[keyCode],Ready.dispatch("keydown",{keyCode:keyCode})},this.down=function(keysToCheck){var keyNames=keysToCheck.split(" ");for(var i in keyNames){var keyName=keyNames[i],code=KeyCodes[keyName];if(keyCodesHeldDown[code])return!0}return!1}};var Ready=new function(){var self=this,started=!1,onLoads=[start],onResizeHandlers=[],scriptsToLoad=[],mouseDownEvt=void 0,cycleInterval=10,handlers=[],imageSizes={},cycleTOH=0,cycleNr=0;function start(){if(!started){for(var i in Ready.Inspector.clear(),started=!0,function(){document.addEventListener("visibilitychange",function(evt){"hidden"==document.visibilityState&&clearTimeout(cycleTOH),"visible"==document.visibilityState&&(clearTimeout(cycleTOH),cycle())});var eventNames=["click","mousedown","touchstart","mousemove","touchmove","mouseup","touchend","keydown","keyup"];for(var i in eventNames){var n=eventNames[i];!function(n){document.addEventListener(n,function(evt){return doEvent(n,evt)})}(n)}}(),scriptsToLoad)loadScript(scriptsToLoad[i]);setTimeout(function(){cycle(),redraw()})}}function loadScript(name){if(!started)return/\.js$/i.test(name)||(name+=".js"),void document.write('<script src="'+name+"?"+1*new Date+'"><\/script>');/\.js$/i.test(name)||(name+=".js");var script=document.createElement("script");script.src=name+"?"+1*new Date,document.body.appendChild(script)}function doEvent(eventName,evt){switch(eventName){case"click":dispatch("click",evt);break;case"mousedown":mouseDownEvt=evt;break;case"touchstart":mouseDownEvt=evt,dispatch("click",evt);break;case"mousemove":case"touchmove":dispatch("mousemove",evt),evt.preventDefault();break;case"mouseup":case"touchend":mouseDownEvt=void 0,dispatch("mouseup",evt);break;case"keydown":dispatch("keypress",evt);break;case"keyup":dispatch("keyup",evt)}}function dispatch(eventName,evt){if(started){var set=handlers[eventName]||[],key=evt.keyCode&&KeyCodes.codes[evt.keyCode];if(key){var set2=handlers[eventName+key];set2&&(set=set.concat(set2))}var sprite=void 0;if(Mouse.sprite){var spriteId=Mouse.sprite.id,set3=handlers[eventName+spriteId];set3&&(sprite=Mouse.sprite,set=set.concat(set3))}for(var i in set){var handler=set[i];evt=new GameEvent(eventName,evt,{key:key,x:Mouse.x,y:Mouse.y,cycle:cycleNr,sprite:sprite});handler.apply(self,[evt])}}}function cycle(){for(var id in cycleTOH=setTimeout(cycle,cycleInterval),dispatch("gameloop",{}),Keys.cycle(),Sprite.sprites)Sprite.sprites[id].cycle(cycleNr);Mouse.down&&mouseDownEvt&&dispatch("mousedown",mouseDownEvt),cycleNr++}function redraw(){for(var id in requestAnimFrame(redraw),window.screen&&Screen.redraw(),Sprite.sprites){Sprite.sprites[id].redraw()}}!function(){var onScope={},eventNames=["keypress","keydown","keyup","click","mousedown","mousemove","mouseup","click","gameloop"];for(var i in eventNames){var eventName=eventNames[i];!function(eventName){onScope[eventName]=function(p1,p2){if("function"==typeof p1){var set=handlers[eventName]||[];return handlers[eventName]=set,set.push(p1),self}if("string"==typeof p1){if("function"==typeof p2){var strings=p1.split(" ");for(var j in strings){var str=strings[j],set=handlers[eventName+str]||[];handlers[eventName+str]=set,set.push(p2)}return self}}else if("object"==typeof p1&&p1.constructor==SpriteInstance&&"function"==typeof p2){var set=handlers[eventName+p1.id]||[];return handlers[eventName+p1.id]=set,set.push(p2),self}}}(eventName)}window.__defineGetter__("on",function(){return onScope})}(),window.onload&&onLoads.unshift(window.onload),window.onload=function(){for(var i in $("body").append('<div id="game"><div id="meta"></div><div id="world"></div></div>'),onLoads)onLoads[i]()},window.onresize&&onResizeHandlers.unshift(window.onresize),window.onresize=function(){for(var i in onResizeHandlers)onResizeHandlers[i]()},this.start=start,this.stop=function(){Sound.stop(),started=!1,clearTimeout(cycleTOH)},this.clear=function(){handlers=[];var cs=[SpriteInstance,SpriteListInstance,LevelInstance];for(var o in window){var obj=window[o];obj&&obj.constructor&&contains(cs,obj.constructor)&&delete window[o]}Screen.clear(),Sound.clear()},this.loadScript=loadScript,this.onLoad=function(h){onLoads.push(h)},this.onResize=function(h){onResizeHandlers.push(h)},this.getSpriteNames=function(){var spriteNames=[];for(var name in window){var obj=window[name];obj&&"object"==typeof obj&&obj.constructor&&"Sprite"==obj.constructor.name&&spriteNames.push(name)}return spriteNames},this.getImageSize=function getImageSize(url,handler){if(!document.body)return getImageSize.waiting||(getImageSize.waiting=[],onLoads.push(function(){for(var i in getImageSize.waiting){var pair=getImageSize.waiting[i];getImageSize(pair.url,pair.handler)}delete getImageSize.waiting})),void getImageSize.waiting.push({url:url,handler:handler});if(imageSizes[url])handler&&handler(url,imageSizes[url]);else{var img=new Image;img.style="position:absolute;left:-9999px;top:-9999px;opacity:0",img.src=url,document.getElementById("meta").appendChild(img),img.onerror=function(err){img.parentNode.removeChild(img)},img.onload=function(){imageSizes[url]={width:this.width,height:this.height},handler&&handler(url,imageSizes[url])}}},this.onOrientationChange=function(value){Controls.onOrientationChange()},this.handlers=handlers,this.dispatch=dispatch,this.__defineGetter__("started",function(){return started})};function SpriteList(){var obj=Object.create(SpriteListInstance.prototype);return SpriteListInstance.apply(obj,arguments),obj}function SpriteListInstance(){SpriteList.lists.push(this);var self=this,contents=[];for(var i in self.length=0,arguments)contents.push(arguments[i]);function update(){var startClean=0;for(i in contents)self[i]=contents[i],startClean++;for(j=startClean;j<self.length;j++)delete self[j];return self.length=contents.length,self}function add(){for(var i in arguments)contents.push(arguments[i]);return update()}function each(h){var obj,items=[];for(var i in contents)items.push(contents[i]);for(var i in items)void 0,obj=items[i],h.apply(obj,[obj,i]);return self}function contains(obj){for(var i in contents)if(contents[i]==obj)return!0;return!1}function getMaxValue(propName,lowest){var value=0;for(var i in contents){var obj=contents[i];"object"==typeof obj&&obj.constructor==SpriteInstance&&(value=lowest?Math.min(obj[propName],value):Math.max(obj[propName],value))}return value}update(),this.add=add,this.addUnique=function(){for(var i in arguments)contains(arguments[i])||add(arguments[i]);return self},this.remove=function(obj){if(!obj){var result=contents.pop();return update(),result}for(var retry=!0;retry;){for(var i in contents)if(contents[i]==obj){contents.splice(i,1),update();break}retry=!1}return update()},this.join=function(list){for(var i=0;i<list.length;i++)add(list[i]);return self},this.each=each,this.clear=function(){return each(function(sprite){sprite.remove()}),contents=[],update(),self},this.contains=contains,this.set=function set(name,value){if("object"==typeof name){for(var n in name)set(n,name[n]);return self}return each(function(sprite,i){console.log(i),sprite[name]=value}),self},this.__defineGetter__("right",function(){return getMaxValue("right")}),this.__defineGetter__("left",function(){return getMaxValue("left",!0)}),this.__defineGetter__("top",function(){return getMaxValue("top",!0)}),this.__defineGetter__("bottom",function(){return getMaxValue("bottom")})}function Sprite(){var obj=Object.create(SpriteInstance.prototype);return SpriteInstance.apply(obj,arguments),obj}function SpriteInstance(p1){var self=this,defaultSize=50,myCycleNr=0,prefixes=["-webkit-","-moz-","-ms-",""],statesChanged={},useTranslate3d=!0,onSolidGround=!1,touchedSolid=!1,sheetInfo={tileX:0,tileY:0,tileX2:0,tileY2:0},sliding={enabled:!1,destX:0,destY:0,duration:0,deltaX:0,deltaY:0},gravitySettings={current:3,max:5,add:.4},oldState={},state={front:{value:0},rotation:{value:0,name:"rotate",isTransform:!0},scaleX:{value:1,isTransform:!0},scaleY:{value:1,isTransform:!0},width:{value:0,unit:"px"},height:{value:0,unit:"px"},background:{value:"transparent",name:"backgroundColor"},image:{value:""},images:{value:[]},left:{value:0,unit:"px"},top:{value:0,unit:"px"},x:{value:void 0},y:{value:void 0},z:{value:1,name:"zIndex"},right:{value:void 0},bottom:{value:void 0},size:{value:void 0},flip:{value:!1},flipY:{value:!1},solid:{value:!1},gravity:{value:!1},fixed:{value:!1},opacity:{value:1},transparency:{value:0},backgroundSize:{value:"contain"},backgroundPosition:{value:"center center"}};function onDOMReady(){$("#world").append(self.$el),initState()}function initState(){for(var name in state){var prop=state[name];(0===prop.value||prop.value)&&changeState(name,prop.value,!0)}}function changeState(name,value,isSystem,isApproach){if(!sliding.enabled||isSystem){if(self.gravity||self.solid){if(!isSystem&&!allowStateChange(name,value)){if(contains(["left","x","right"],name)&&!isNaN(value)){var curValue=self[name];value>curValue&&changeState(name,Math.max(curValue,value-1),!1,!0),value<curValue&&changeState(name,Math.min(curValue,value+1),!1,!0),touchedSolid=!0}return}contains(["left","x","right"],name)&&(touchedSolid=isApproach)}for(var n in oldState={},state)oldState[n]=state[n];switch(state[name].value=value,statesChanged[name]=!0,name){case"left":state.x.value=value+Math.floor(self.width/2),state.right.value=value+self.width;break;case"top":state.y.value=value+Math.floor(self.height/2),state.bottom.value=value+self.height;break;case"x":self.left=value-Math.floor(self.width/2);break;case"y":self.top=value-Math.floor(self.height/2);break;case"right":self.left=value-self.width;break;case"bottom":self.top=value-self.height;break;case"width":void 0!==oldState.x.value&&(self.x=oldState.x.value),isSystem||(state.size.value=void 0);break;case"height":self.gravity?void 0!==oldState.bottom.value&&(self.bottom=oldState.bottom.value):void 0!==oldState.y.value&&(self.y=oldState.y.value),isSystem||(state.size.value=void 0);break;case"image":Ready.getImageSize(value),self.size||self.width||self.height||(self.size=defaultSize),self.size&&(self.size=self.size);break;case"images":if(value&&value.length)for(var i in self.image=value[0],value)Ready.getImageSize(value[i]);break;case"size":if(changeState("height",value,!0),self.sheet){updateSizeBySheet();break}Ready.getImageSize(self.image,function(url,size){if(size&&self.size&&void 0!==size.width&&url==self.image){var w=Math.round(value/size.height*size.width);w&&changeState("width",w,!0)}});break;case"flip":changeState("scaleX",1==value||1==value?-1:1);break;case"flipY":changeState("scaleY",1==value||1==value?-1:1);break;case"solid":value?Sprite.solids.addUnique(self):Sprite.solids.remove(self);break;case"gravity":value?Sprite.gravities[self.id]=self:delete Sprite.gravities[self.id];break;case"opacity":state.transparency.value=1-value;break;case"transparency":self.opacity=1-value}}}function set(name,value){if("object"==typeof name){for(var n in name)set(n,name[n]);return self}return state[name]&&(self[name]=value),self}function goTo(x,y){return"object"==typeof x&&void 0!==x.x&&void 0!==x.y?goTo(x.x,x.y):(self.x=x,self.y=y,self)}function touches(){var sides={},sprites=[];for(var i in arguments){var obj=arguments[i];if("string"==typeof obj){var sideStrs=obj.toLowerCase().split(" ");for(i=0;i<sideStrs.length;i++){var str=sideStrs[i];contains(["left","top","right","bottom"],str)&&(sides[str]=!0)}}if("object"==typeof obj&&obj.constructor==SpriteInstance)obj.isSliding||obj.id!=self.id&&sprites.push(obj);else if("object"==typeof obj&&obj.constructor==SpriteListInstance)obj.each(function(listObj){"object"!=typeof listObj||listObj.constructor!=SpriteInstance||listObj.isSliding||listObj.id!=self.id&&sprites.push(listObj)});else if("object"==typeof obj&&obj.isScreen){if(this.right>obj.right)return screen;if(this.left<obj.left)return screen;if(this.top<obj.top)return screen;if(this.bottom>obj.bottom)return screen}}for(var i in sprites){var sprite=sprites[i];if(!(this.left>=sprite.right)&&!(this.right<=sprite.left||this.top>=sprite.bottom||this.bottom<=sprite.top)){if(!(Object.keys(sides).length>0))return sprite;if(sides.top&&this.bottom<=sprite.y)return sprite;if(sides.bottom&&this.top>=sprite.y)return sprite;if(sides.left&&this.right<=sprite.x)return sprite;if(sides.right&&this.left>=sprite.x)return sprite}}return!1}function allowMove(name,value){return!!state[name]&&allowStateChange(name,state[name].value+value)}function allowStateChange(name,value){if(sliding.enabled)return!0;if(!self.gravity&&!self.solid)return!0;var needsSolidCheck=!1;switch(name){case"x":case"left":case"right":case"y":case"top":case"bottom":needsSolidCheck=!0}if(!needsSolidCheck)return!0;if(!Sprite.solids||!Sprite.solids.length)return!0;onSolidGround=!1;var box={left:self.left,top:self.top,right:self.right,bottom:self.bottom};switch(name){case"x":value-=Math.floor(self.width/2);case"left":box.left=value,box.right=box.left+self.width;break;case"y":value-=Math.floor(self.height/2);case"top":box.top=value,box.bottom=box.top+self.height;break;case"right":box.right=value,box.left=box.right-self.width;break;case"bottom":box.bottom=value,box.top=box.bottom-self.height}return!touches.apply(box,Sprite.solids)}function setTile(tx,ty,tx2,ty2){var sheet=self.sheet;if(!sheet)throw"sprite.setTile(-) cannot be called when the sprite is not retrieved from a SpriteSheet";if(!sheet.columns||!sheet.rows)throw"You must call sheet.setGridSize(-,-) BEFORE doing getSprite(-)";if(arguments.length>0){if(void 0===ty){var index=tx-1;return y=Math.floor(index/sheet.columns),x=index-y*sheet.columns,setTile(tx=x+1,ty=y+1)}sheetInfo.tileX=tx,sheetInfo.tileY=ty,sheetInfo.tileX2=tx2,sheetInfo.tileY2=ty2}updateSizeBySheet()}function updateSizeBySheet(){var sheet=self.sheet;if(sheet.tileWidth&&sheet.tileHeight){sheetInfo.tileNr=(sheetInfo.tileY-1)*sheet.columns+sheetInfo.tileX;var tileCountH=1+(sheetInfo.tileX2?sheetInfo.tileX2-sheetInfo.tileX:0),tileCountV=1+(sheetInfo.tileY2?sheetInfo.tileY2-sheetInfo.tileY:0),size=self.size||self.height,sizeFactor=size/(sheet.tileHeight*tileCountV),px=-(sheetInfo.tileX-1)*sheet.tileWidth*sizeFactor,py=-(sheetInfo.tileY-1)*sheet.tileHeight*sizeFactor;self.width=sheet.tileWidth*tileCountH*sizeFactor,self.height=size,self.backgroundSize=sheet.width*sizeFactor+"px "+sheet.height*sizeFactor+"px",self.backgroundPosition=px+"px "+py+"px"}}!function(){Sprite.id++,self.id="sprite"+Sprite.id,Sprite.sprites[self.id]=self,self.$el=$('<div id="'+self.id+'" class="sprite"></div>'),self.handlers=[],self.removed=!1,function(){for(var name in state)!function(n){state[n],self.__defineSetter__(n,function(v){changeState(n,v)}),self.__defineGetter__(n,function(){return state[n].value})}(name)}(),document.body?onDOMReady():Ready.onLoad(onDOMReady);"string"==typeof p1?self.image=p1:"object"==typeof p1&&set(p1);initState()}(),this.move=function move(name,value){if("number"==typeof name&&"number"==typeof value)return move({x:name,y:value});if(!value&&"number"==typeof name){var radians=(state.rotation.value+state.front.value)*(Math.PI/180),dx=Math.cos(radians)*name,dy=Math.sin(radians)*name;return self.move({x:dx,y:dy}),self}if("object"==typeof name){for(var n in name)move(n,name[n]);return self}if(0!==value){var prop=state[name];prop&&set(name,prop.value+value)}return self},this.set=set,this.turn=function(value){return void 0===value?(self.rotation+=180,self.flipY=!self.flipY):self.rotation+=isNaN(value)?0:value,self},this.pointTo=function pointTo(value){return"object"==typeof value&&void 0!==value.x&&void 0!==value.y?pointTo(180*Math.atan2(value.y-self.y,value.x-self.x)/Math.PI):(self.rotation=isNaN(value)?0:value,self)},this.goto=goTo,this.goTo=goTo,this.hide=function(){return self.$el.hide(),self},this.show=function(){return self.$el.show(),self},this.remove=function(cleanup){self.removed||(SpriteList.removeSprite(self),self.$el.remove(),delete Sprite.sprites[self.id],self.removed=!0)},this.clone=function clone(x,y){if(void 0===x&&void 0===y)return clone(self);if("object"==typeof x&&void 0!==x.x&&void 0!==x.y)return clone(x.x,x.y);var newSprite=Sprite();for(var name in state)newSprite[name]=self[name];return newSprite.x=x,newSprite.y=y,newSprite},this.touches=function(){return touches.apply(self,arguments)},this.onDOMReady=onDOMReady,this.redraw=function(){if(Object.keys(statesChanged).length>0){var transformValue="",cssModifiers={},needsTransform=!1;for(var n in statesChanged){var prop=state[n];if(name=prop.name||n,value=prop.value,prop.isTransform)needsTransform=!0;else switch(n){case"x":case"y":case"right":case"bottom":case"size":case"flip":case"flipY":case"solid":case"gravity":case"front":case"images":break;case"image":cssModifiers["background-image"]="url("+encodeURI(value)+")";break;case"fixed":value?($("#game").append(self.$el),self.depth=10):($("#game #world").append(self.$el),self.depth=0);break;case"left":case"top":if(useTranslate3d)break;default:prop.unit&&!/\%|px/i.test(value+"")&&(value+=prop.unit),cssModifiers[name]=value}}if(useTranslate3d&&(statesChanged.left||statesChanged.top||needsTransform)&&(transformValue="translate3d("+state.left.value+"px,"+state.top.value+"px, 0) ",needsTransform=!0),needsTransform)for(var n in state)if(prop=state[n],name=prop.name||n,value=prop.value,prop.isTransform){var unit="rotate"==name?"deg":"";transformValue+=name+"("+value+unit+") "}if(""!=transformValue)for(var i in prefixes)cssModifiers[prefixes[i]+"transform"]=transformValue;$(self.$el).css(cssModifiers),statesChanged={}}},this.nextImage=function nextImage(step){if(self.images)return void 0===nextImage.index||nextImage.index>=self.images.length-1?nextImage.index=0:nextImage.index+=step?1/step:1,self.image=self.images[Math.round(nextImage.index)],self},this.cycle=function(nr){return 0==myCycleNr&&initState(),myCycleNr++,nr,sliding.enabled&&function(){var perc=Math.min(1,(new Date-sliding.started)/sliding.duration);if(1==perc)sliding.enabled=!1,self.x=sliding.destX,self.y=sliding.destY,sliding.handler&&sliding.handler();else{var newLeft=perc*sliding.deltaX+sliding.startLeft,newTop=perc*sliding.deltaY+sliding.startTop;changeState("left",newLeft,!0),changeState("top",newTop,!0)}}(),self.gravity&&function(){if(!sliding.enabled){var isJump=gravitySettings.current<=0;if(isJump||onSolidGround||(onSolidGround=!allowMove("y",1)),isJump||!onSolidGround){gravitySettings.current=Math.min(gravitySettings.current+gravitySettings.add,gravitySettings.max);for(var destY=self.y+gravitySettings.current,oldY=self.y;self.y==oldY;)self.y=destY,self.y==oldY&&(destY=destY>self.y?Math.max(self.y,destY-1):Math.min(self.y,destY+1));isJump?allowMove("y",-1)||(gravitySettings.current=.1):onSolidGround=!allowMove("y",1)}}}(),self},this.jump=function(howHigh){if(!sliding.enabled&&self.gravity&&(onSolidGround=!allowMove("y",1))&&!(gravitySettings.current<0))return howHigh=howHigh||1,gravitySettings.current=-self.height/12-1.4*howHigh,self},this.slideTo=function slideTo(px,py,ps){if("object"==typeof px&&void 0!==px.x&&void 0!==px.y)return slideTo(px.x,px.y,ps);for(var i in ps=ps||1,sliding.destX=px,sliding.destY=py,sliding.duration=1e3*ps,sliding.deltaX=px-self.x,sliding.deltaY=py-self.y,sliding.enabled=!0,sliding.handler=void 0,arguments){var arg=arguments[i];"function"==typeof arg&&(sliding.handler=arg)}sliding.started=new Date,sliding.startLeft=self.left,sliding.startTop=self.top},this.setTile=setTile,this.__defineGetter__("isSliding",function(){return sliding.enabled}),this.__defineGetter__("style",function(){return self.$el[0]?self.$el[0].style:{}}),this.__defineGetter__("touchedSolid",function(){return touchedSolid}),this.__defineGetter__("screenX",function(){return self.x+Screen.worldLeft}),this.__defineGetter__("screenY",function(){return self.y+Screen.worldTop}),this.allowStateChange=allowStateChange,this.allowMove=allowMove,this.cycleTiles=function cycleTiles(tilesArr){if(arguments.length>1&&!Array.isArray(tilesArr)){for(var arr=[],i=0;i<arguments.length;i++)arr.push(arguments[i]);return cycleTiles(arr)}if(Array.isArray(tilesArr)&&tilesArr.length){if(!sheetInfo.animation||sheetInfo.animation.join(",")!=tilesArr.join(",")){for(sheetInfo.animation=tilesArr,i=0;i<tilesArr.length;i++)if(tilesArr[i]==sheetInfo.tileNr){found=!0,sheetInfo.index=i;break}sheetInfo.index=0}sheetInfo.index++,sheetInfo.index>sheetInfo.animation.length-1&&(sheetInfo.index=0),setTile(sheetInfo.animation[sheetInfo.index])}return self},this.animateTiles=function(){}}SpriteList.lists=SpriteList.lists||[],SpriteList.removeSprite=function(sprite){for(var i in SpriteList.lists){SpriteList.lists[i].remove(sprite)}},Sprite.id=0,Sprite.sprites={},Sprite.solids=SpriteList(),Sprite.gravities={},SpriteInstance.prototype.toString=function(){var state={front:{value:0},rotation:{value:0,name:"rotate",isTransform:!0},scaleX:{value:1,isTransform:!0},scaleY:{value:1,isTransform:!0},width:{value:0,unit:"px"},height:{value:0,unit:"px"},background:{value:"transparent",name:"backgroundColor"},image:{value:""},images:{value:[]},depth:{value:1,name:"zIndex"},left:{value:0,unit:"px"},top:{value:0,unit:"px"},x:{value:void 0},y:{value:void 0},right:{value:void 0},bottom:{value:void 0},size:{value:void 0},flip:{value:!1},flipY:{value:!1},solid:{value:!1},gravity:{value:!1},fixed:{value:!1},opacity:{value:1},transparency:{value:0}},changedProps="";for(var name in state)this[name]!=state[name].value&&(changedProps+=name+": "+this[name]+", ");return"Sprite('"+this.image+"') {"+changedProps+"}"},window.Mouse=new function(){var self=this,x=0,y=0,isDown=!1;function mousedown(evt){isDown=!0,Ready.Inspector.click(evt,self.sprite)}function mouseup(evt){isDown=!1}function checkForSprite(evt){var xyEvt=evt.touches?evt.touches[0]:evt,x=xyEvt.pageX,y=xyEvt.pageY,el=document.elementFromPoint(x,y);el&&"sprite"==el.className?self.sprite=Sprite.sprites[el.id]:self.sprite=void 0}self.sprite=void 0,document.addEventListener("mousedown",mousedown),document.addEventListener("mouseup",mouseup),document.addEventListener("mousemove",function(evt){evt.which||(isDown=!1);checkForSprite(evt),Screen.$el[0]&&(x=evt.pageX-Screen.$el[0].offsetLeft,y=evt.pageY-Screen.$el[0].offsetTop,Ready.Inspector.mousemove(evt,x,y))}),document.addEventListener("touchstart",mousedown),document.addEventListener("touchend",mouseup),document.addEventListener("touchmove",function(evt){Screen.$el[0]&&(checkForSprite(evt),x=evt.touches[0].pageX-Screen.$el[0].offsetLeft,y=evt.touches[0].pageY-Screen.$el[0].offsetTop)}),this.__defineGetter__("x",function(){return x}),this.__defineGetter__("y",function(){return y}),this.__defineGetter__("down",function(){return isDown})},window._Screen=Screen;var Screen=new function(){var self=this;self.$el=$("#game"),self.$world=$("#world"),self.isScreen=!0;var orientations={portrait:{width:360,height:540},landscape:{width:540,height:360}},useTranslate3d=!0,prefixes=["-webkit-","-moz-","-ms-",""],statesChanged={},state={rotation:{value:0,name:"rotate",isTransform:!0},scaleX:{value:1,isTransform:!0},scaleY:{value:1,isTransform:!0},width:{value:360,unit:"px"},height:{value:540,unit:"px"},background:{value:"white",name:"backgroundColor"},image:{value:""},depth:{value:1,name:"zIndex"},left:{value:0,unit:"px"},top:{value:0,unit:"px"},x:{value:void 0},y:{value:void 0},right:{value:void 0},bottom:{value:void 0},flip:{value:!1},flipY:{value:!1},worldLeft:{value:0,unit:"px"},worldTop:{value:0,unit:"px"},orientation:{value:"portrait"}},initialState=JSON.parse(JSON.stringify(state));function onDOMReady(){self.$el=$("#game"),self.$world=$("#world"),adjustToOrientation(),initState()}function adjustToOrientation(){self.$el[0].style.visibility="hidden",setTimeout(function(){self.width=self.width,self.height=self.height,self.$el[0].style.visibility="visible"})}function initGettersAndSetters(){for(var name in state)!function(n){state[n];self.__defineSetter__(n,function(v){changeState(n,v)}),self.__defineGetter__(n,function(){return state[n].value})}(name)}function initState(){for(var name in state){var prop=state[name];void 0!==prop.value&&(self[name]=prop.value)}}function changeState(name,value,isSystem){var oldState={};for(var n in state)oldState[n]=state[n];switch(state[name].value=value,statesChanged[name]=!0,name){case"left":state.x.value=value+Math.round(self.width/2),state.right.value=value+self.width;break;case"top":state.y.value=value+Math.round(self.height/2),state.bottom.value=value+self.height;break;case"x":self.left=value-Math.round(self.width/2);break;case"y":self.top=value-Math.round(self.height/2);break;case"right":self.left=value-self.width;break;case"bottom":self.top=value-self.height;break;case"image":Ready.getImageSize(value);break;case"height":case"width":break;case"flip":changeState("scaleX",1==value||1==value?-1:1);break;case"flipY":changeState("scaleY",1==value||1==value?-1:1);break;case"orientation":if(contains(Object.keys(orientations),value)){self.value=value;var or=orientations[value];self.width=or.width,self.height=or.height,self.left=self.left,self.top=self.top,Ready.onOrientationChange(value)}}}function set(name,value){if("object"==typeof name){for(var n in name)set(n,name[n]);return self}return state[name]&&(self[name]=value),self}!function(){document.body?onDOMReady():Ready.onLoad(onDOMReady);initGettersAndSetters()}(),this.move=function move(name,value){if(!value&&"number"==typeof name){var radians=state.rotation.value*(Math.PI/180),dx=Math.cos(radians)*name,dy=Math.sin(radians)*name;return self.move({x:dx,y:dy}),self}if("object"==typeof name){for(var n in name)move(n,name[n]);return self}var prop=state[name];return prop&&set(name,prop.value+value),self},this.set=set,this.turn=function(value){return void 0===value?(self.rotation+=180,self.flipY=!self.flipY):self.rotation+=isNaN(value)?0:value,self},this.pointTo=function(value){return self.rotation=isNaN(value)?0:value,self},this.hide=function(){return self.$el.hide(),self},this.show=function(){return self.$el.show(),self},this.onDOMReady=onDOMReady,this.redraw=function(){if(Object.keys(statesChanged).length){var transformValue="",cssModifiers={};for(var n in statesChanged){var prop=state[n];if(name=prop.name||n,value=prop.value,prop.isTransform){var unit="rotate"==name?"deg":"";transformValue+=name+"("+value+unit+") "}else switch(n){case"x":case"y":case"right":case"bottom":case"flip":case"flipY":case"worldLeft":case"worldTop":case"orientation":break;case"image":cssModifiers["background-image"]="url("+value+")";break;default:prop.unit&&!/\%|px/i.test(value+"")&&(value+=prop.unit),cssModifiers[name]=value}}if(""!=transformValue)for(var i in prefixes)cssModifiers[prefixes[i]+"transform"]=transformValue;if($(self.$el).css(cssModifiers),statesChanged.worldLeft||statesChanged.worldTop){var worldCssModifiers={};if(useTranslate3d)for(var i in prefixes)worldCssModifiers[prefixes[i]+"transform"]="translate3d("+state.worldLeft.value+"px, "+state.worldTop.value+"px, 0)";else statesChanged.worldLeft&&(worldCssModifiers.left=state.worldLeft.value+"px"),statesChanged.worldTop&&(worldCssModifiers.top=state.worldTop.value+"px");self.$world.css(worldCssModifiers)}statesChanged={}}},this.portrait=function(){self.orientation="portrait",adjustToOrientation()},this.landscape=function(){self.orientation="landscape",adjustToOrientation()},this.center=function(sprite,box){var needsHorizontalCenter=(box=box||(Level.currentLevel?Level.currentLevel.sprites:screen)).right-box.left>Screen.width,needsVerticalCenter=box.bottom-box.top>Screen.height;if(needsHorizontalCenter){var dx=sprite.x+self.worldLeft-Math.floor(self.width/2);if(dx>0){var max=box.right;self.worldLeft-dx>-(max-self.width)?self.worldLeft-=dx:self.worldLeft=-(max-self.width)}if(dx<0){var min=box.left;self.worldLeft-dx<-min?self.worldLeft-=dx:self.worldLeft=-min}}if(needsVerticalCenter){var dy=sprite.y+self.worldTop-Math.floor(self.height/2);dy>0&&(max=box.bottom,self.worldTop-dy>-(max-self.height)?self.worldTop-=dy:self.worldTop=-(max-self.height)),dy<0&&(min=box.top,self.worldTop-dy<-min?self.worldTop-=dy:self.worldTop=-min)}},this.clear=function(){state=initialState,initGettersAndSetters(),initState(),$("#game").remove(),$("body").append('<div id="game"><div id="meta"></div><div id="world"></div></div>'),self.$el=$("#game"),self.$world=$("#world")},this.__defineGetter__("style",function(){return self.$el[0]?self.$el[0].style:{}})};function Level(){var obj=Object.create(LevelInstance.prototype);return LevelInstance.apply(obj,arguments),obj}function LevelInstance(tileWidth,tileHeight){var self=this;self.sprites=SpriteList();var state={data:{value:[]},tileWidth:{value:tileWidth||50},tileHeight:{value:tileHeight||tileWidth||50}},tileMap={};(function(){for(var name in state)!function(n){state[n],self.__defineSetter__(n,function(v){var value;value=v,state[n].value=value}),self.__defineGetter__(n,function(){return state[n].value})}(name)})(),function(){for(var name in state){var prop=state[name];void 0!==prop.value&&(self[name]=prop.value)}}(),this.load=function load(p1){if(1!=arguments.length||!Array.isArray(p1)){for(var arr=[],i=0;i<arguments.length;i++)arr[i]=arguments[i];return load(arr)}self.data=p1},this.setTileSize=function(tileWidth,tileHeight){self.tileWidth=tileWidth,self.tileHeight=tileHeight},this.setTile=function(char,image,props){props||"object"!=typeof image||(props=image,image=void 0),props=props||{},image&&(props.image=image),tileMap[char]=props},this.draw=function(startX,startY){Level.currentLevel=self,self.sprites.clear(),startX=startX||0,startY=startY||0;for(var levelData=state.data.value,y=0;y<levelData.length;y++)for(var str=levelData[y],x=0;x<str.length;x++){var ch=str.charAt(x),px=startX+state.tileWidth.value*x,py=startY+state.tileHeight.value*y,map=tileMap[ch];if(map){for(var n in spr=Sprite(),spr.width=state.tileWidth.value,spr.height=state.tileHeight.value,spr.left=px,spr.top=py,spr.__levelChar=ch,map)spr[n]=map[n];self.sprites.add(spr)}}},this.getSprite=function(char){for(var i=0;i<self.sprites.length;i++){var sprite=self.sprites[i];if(sprite&&sprite.__levelChar==char)return sprite}},this.getSpriteList=function(chars){if(!chars)return self.sprites;for(var list=SpriteList(),i=0;i<self.sprites.length;i++){var sprite=self.sprites[i];sprite&&sprite.__levelChar&&chars.indexOf(sprite.__levelChar)>=0&&list.add(sprite)}return list},this.clear=function(){self.sprites.clear(),Level.currentLevel=void 0}}Level.currentLevel=void 0;var Controls=new function(){var self=this,transparency=.5,controls={};function onDOMReady(){!function(){for(var n in controls)!function(n){var control=controls[n],sprite=control.sprite;self[n]=sprite,sprite.transparency=transparency,sprite.fixed=!0,sprite.hide(),sprite.width=control.w,sprite.height=control.h,on.mousedown(sprite,buttonDown),sprite.bind=function(key){return control.binding=control.binding||{},control.binding[key]=!0,sprite},sprite.unbind=function(key){return control.binding=control.binding||[],delete control.binding[key],sprite},control.key&&sprite.bind(control.key)}(n)}(),on.gameloop(cycle)}function cycle(){}function buttonDown(evt){}function onOrientationChange(){}document.body?onDOMReady():Ready.onLoad(onDOMReady),this.onOrientationChange=onOrientationChange};function ViewportMaster({element:element,width:width,height:height,keepCentered:keepCentered}){width||(width=element.getBoundingClientRect().width),height||(height=element.getBoundingClientRect().height);var app={width:width,height:height};console.log(app);var isMobile=/mac|win/i.test(navigator.platform)&&/ipad|iphone|ipod|android/i.test(navigator.appVersion)||void 0!==window.orientation;keepCentered&&(element.style.width=app.width+"px",element.style.height=app.height+"px");var oldOnresize=window.onresize;function adjust(){if(document.body.style.display="hidden",console.log("adjust"),keepCentered&&(element.style.margin=""),!isMobile){if(!keepCentered)return;var visibleHeight=document.body.scrollHeight,visibleWidth=document.body.scrollWidth;return element.style.marginTop=Math.floor((visibleHeight-app.height)/2)+"px",void(element.style.marginLeft=Math.floor((visibleWidth-app.width)/2)+"px")}var scr=(window.orientation||0)in{"-90":1,90:1}?{width:Screen.height,height:Screen.width}:screen,screenRatio=scr.width/scr.height,content=[];if(app.width/app.height>=screenRatio){if(content.push("width="+app.width),keepCentered){visibleHeight=Math.floor(app.width/document.body.scrollWidth*document.body.scrollHeight);visibleHeight=Math.min(visibleHeight,window.innerHeight),element.style.marginTop=Math.floor((visibleHeight-app.height)/2)+"px"}}else if(content.push("height="+app.height),keepCentered){visibleWidth=Math.floor(app.height/document.body.scrollHeight*document.body.scrollWidth);visibleWidth=Math.min(visibleWidth,window.innerWidth),element.style.marginLeft=Math.floor((visibleWidth-app.width)/2)+"px"}content.push("user-scalable=0");var meta=document.querySelector('meta[name="viewport"]');meta||(meta=document.createElement("meta"),document.getElementsByTagName("head")[0].appendChild(meta)),meta.setAttribute("name","viewport"),meta.setAttribute("content",content.join(", ")),document.body.style.display=""}window.onresize=function(){isMobile||adjust(),oldOnresize&&oldOnresize()},window.addEventListener("orientationchange",function(){setTimeout(adjust,400)}),adjust()}function Sound(){if(arguments.length){var obj=Object.create(SoundEffect.prototype);return SoundEffect.apply(obj,arguments),obj}}function SoundEffect(path){var self=this,state={instances:[],loop:!1,current:1,count:10,volume:100};function changeState(name,value){switch(state[name]=value,name){case"volume":for(var i=0;i<state.count;i++){(audio=state.instances[i])&&(audio.volume=value/100)}break;case"loop":for(i=0;i<state.count;i++){var audio;(audio=state.instances[i])&&(audio.loop=value)}}}!function(){Sound.id++,self.id="sound"+Sound.id,Sound.sounds[self.id]=self;for(var i=0;i<state.count;i++){var audio=new Audio(encodeURI(path));audio.preload=!0,audio.load(),audio.volume=state.volume/100,audio.loop=state.loop,state.instances.push(audio)}}(),this.play=function(){if(state.current=++state.current%state.count,state.loop){var audio=state.instances[state.current];audio.seekTo&&audio.seekTo(0),audio.play({numberOfLoops:999,playAudioWhenScreenIsLocked:!1})}else state.instances[state.current].play({playAudioWhenScreenIsLocked:!1})},this.stop=function(){for(var i=0;i<state.count;i++){var audio=state.instances[i];audio&&audio.pause()}},this.__defineGetter__("loop",function(){return state.loop}),this.__defineSetter__("loop",function(v){changeState("loop",v)}),this.__defineGetter__("volume",function(){return state.volume}),this.__defineSetter__("volume",function(v){changeState("volume",v)})}function log(){const messageString=Array.prototype.slice.call(arguments).join(" ");console.log("[READYJS]",messageString),window.self!==window.top&&window.parent.postMessage({action:"log",message:messageString},"*")}function SpriteSheet(){var obj=Object.create(SpriteSheetInstance.prototype);return SpriteSheetInstance.apply(obj,arguments),obj}function SpriteSheetInstance(image,columns,rows){var self=this,spritesBasedOnSheet=SpriteList(),state={columns:{value:columns||0},rows:{value:rows||0},width:{value:0},height:{value:0},tileWidth:{value:0},tileHeight:{value:0},image:{value:image||""}};function changeState(name,value){switch(state[name].value=value,name){case"image":Ready.getImageSize(self.image,imageSizeCallback);break;case"columns":case"rows":case"tileWidth":case"tileHeight":updateSpritesBasedOnSheet()}}function imageSizeCallback(url,size){size.width&&size.height&&(self.width=size.width,self.height=size.height,updateSpritesBasedOnSheet())}function updateSpritesBasedOnSheet(){self.width&&self.height&&self.columns&&self.rows&&(self.tileWidth?self.tileHeight?each(spritesBasedOnSheet,updateSprite):self.tileHeight=self.height/self.rows:self.tileWidth=self.width/self.columns)}function updateSprite(sprite){sprite.setTile()}(function(){for(var name in state)!function(n){state[n],self.__defineSetter__(n,function(v){changeState(n,v)}),self.__defineGetter__(n,function(){return state[n].value})}(name)})(),function(){for(var name in state){var prop=state[name];void 0!==prop.value&&(self[name]=prop.value)}}(),this.setGridSize=function(columns,rows){self.columns=columns,self.rows=rows},this.getSprite=function(tx,ty,tx2,ty2){if(!self.columns||!self.rows)throw"You must call sheet.setGridSize(-,-) BEFORE doing getSprite(-)";var sprite=Sprite(image);return spritesBasedOnSheet.add(sprite),sprite.sheet=self,sprite.setTile(tx,ty,tx2,ty2),sprite}}Ready.Inspector=new function(){function isEnabled(){return!Ready.started&&Screen.$el[0]}this.mousemove=function(evt,x,y){isEnabled()&&window.parent.postMessage({action:"pointer",position:{x:x,y:y}},"*")},this.click=function(evt,sprite){isEnabled()&&sprite&&($(".inspector-selected").removeClass("inspector-selected"),sprite.$el.addClass("inspector-selected"),window.parent.postMessage({action:"selectSprite",sprite:sprite.state},"*"))},this.clear=function(){$(".inspector-selected").removeClass("inspector-selected")}},Sound.id=0,Sound.sounds={},Sound.stop=function(){for(var id in Sound.sounds)Sound.sounds[id].stop()},Sound.clear=function(){Sound.stop(),Sound.sounds={},Sound.id=0};